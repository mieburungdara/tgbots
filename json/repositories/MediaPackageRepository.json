{
  "class_name": "MediaPackageRepository",
  "table": "media_packages",
  "summary": "Mengelola entitas paket media, inti dari fitur penjualan.",
  "description": "Repositori ini adalah salah satu yang paling kompleks, bertanggung jawab atas semua operasi terkait paket media. Ini termasuk pembuatan, pencarian, pembaruan, penghapusan, dan pemeriksaan status.",
  "methods": [
    {
      "name": "__construct",
      "description": "Menginisialisasi repositori dengan koneksi PDO.",
      "parameters": [
        {
          "name": "pdo",
          "type": "PDO",
          "description": "Objek koneksi database."
        }
      ]
    },
    {
      "name": "find",
      "description": "Mencari paket berdasarkan ID internalnya.",
      "parameters": [
        {
          "name": "id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "array|false"
    },
    {
      "name": "getPackageFiles",
      "description": "Mengambil semua file media yang dapat dikirim dari sebuah paket (yang memiliki storage_message_id).",
      "parameters": [
        {
          "name": "package_id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "array"
    },
    {
      "name": "getFilesByPackageId",
      "description": "Mengambil detail (tipe, ukuran file) dari semua file dalam sebuah paket untuk tujuan ringkasan.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "array"
    },
    {
      "name": "getGroupedPackageContent",
      "description": "Mengelompokkan file media dari sebuah paket ke dalam 'halaman' berdasarkan media_group_id. Berguna untuk paginasi.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "array"
    },
    {
      "name": "findForPurchase",
      "description": "Mencari paket yang tersedia untuk dibeli, hanya mengambil data harga dan penjual.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "array|false"
    },
    {
      "name": "markAsSold",
      "description": "Menandai sebuah paket sebagai 'terjual' setelah transaksi berhasil.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int",
          "description": "ID internal paket."
        }
      ],
      "returns": "void"
    },
    {
      "name": "findAllBySellerId",
      "description": "Menemukan semua paket yang dimiliki oleh seorang penjual.",
      "parameters": [
        {
          "name": "seller_user_id",
          "type": "int",
          "description": "ID internal pengguna penjual."
        }
      ],
      "returns": "array"
    },
    {
      "name": "softDeletePackage",
      "description": "Menandai sebuah paket sebagai 'deleted' (soft delete). Melempar Exception jika pengguna tidak berhak atau paket sudah terjual.",
      "parameters": [
        {
          "name": "packageId",
          "type": "int"
        },
        {
          "name": "seller_user_id",
          "type": "int"
        }
      ],
      "returns": "bool"
    },
    {
      "name": "hardDeletePackage",
      "description": "Menghapus paket dan file media terkait secara permanen dari database. Mengembalikan daftar file yang perlu dihapus dari channel penyimpanan.",
      "parameters": [
        {
          "name": "packageId",
          "type": "int"
        }
      ],
      "returns": "array"
    },
    {
      "name": "findAll",
      "description": "Mengambil semua paket dengan paginasi untuk panel admin.",
      "parameters": [
        {
          "name": "limit",
          "type": "int"
        },
        {
          "name": "offset",
          "type": "int"
        }
      ],
      "returns": "array"
    },
    {
      "name": "findByPublicId",
      "description": "Mencari paket berdasarkan ID publiknya.",
      "parameters": [
        {
          "name": "publicId",
          "type": "string"
        }
      ],
      "returns": "array|false"
    },
    {
      "name": "toggleProtection",
      "description": "Mengaktifkan atau menonaktifkan proteksi konten untuk sebuah paket.",
      "parameters": [
        {
          "name": "packageId",
          "type": "int"
        },
        {
          "name": "seller_user_id",
          "type": "int"
        }
      ],
      "returns": "bool"
    },
    {
      "name": "updatePackageDetails",
      "description": "Memperbarui deskripsi dan harga sebuah paket.",
      "parameters": [
        {
          "name": "packageId",
          "type": "int"
        },
        {
          "name": "seller_user_id",
          "type": "int"
        },
        {
          "name": "description",
          "type": "string"
        },
        {
          "name": "price",
          "type": "?int"
        }
      ],
      "returns": "bool"
    },
    {
      "name": "createPackageWithPublicId",
      "description": "Membuat paket baru, termasuk menghasilkan ID publik yang unik berdasarkan urutan penjual.",
      "parameters": [
        {
          "name": "seller_user_id",
          "type": "int"
        },
        {
          "name": "bot_id",
          "type": "int"
        },
        {
          "name": "description",
          "type": "string"
        },
        {
          "name": "thumbnail_media_id",
          "type": "int"
        },
        {
          "name": "post_type",
          "type": "string"
        },
        {
          "name": "category",
          "type": "?string"
        }
      ],
      "returns": "int"
    },
    {
      "name": "getThumbnailFile",
      "description": "Mendapatkan file thumbnail yang valid untuk sebuah paket. Jika thumbnail eksplisit tidak valid, akan mencari file valid pertama.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int"
        }
      ],
      "returns": "array|false"
    },
    {
      "name": "updateStatus",
      "description": "Memperbarui status sebuah paket (misalnya, menjadi 'available' atau 'pending').",
      "parameters": [
        {
          "name": "package_id",
          "type": "int"
        },
        {
          "name": "status",
          "type": "string"
        }
      ],
      "returns": "bool"
    },
    {
      "name": "hasPendingPost",
      "description": "Memeriksa apakah seorang pengguna memiliki kiriman yang sedang menunggu moderasi.",
      "parameters": [
        {
          "name": "user_id",
          "type": "int"
        }
      ],
      "returns": "bool"
    },
    {
      "name": "updatePrice",
      "description": "Memperbarui harga untuk sebuah paket.",
      "parameters": [
        {
          "name": "package_id",
          "type": "int"
        },
        {
          "name": "price",
          "type": "int"
        }
      ],
      "returns": "bool"
    }
  ]
}
