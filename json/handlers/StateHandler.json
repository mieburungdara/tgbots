{
  "class_name": "StateHandler",
  "summary": "Menangani pesan dari pengguna dalam state tertentu, dengan penanganan `/cancel` secara global.",
  "description": "Handler ini dipanggil oleh `MessageHandler` jika pengguna memiliki state percakapan aktif. Tugasnya adalah menangani perintah `/cancel` secara universal, dan jika bukan, mendelegasikan pesan ke `StateRouter` untuk diproses oleh handler state yang spesifik.",
  "dependencies": [
    "StateRouter",
    "UserRepository"
  ],
  "methods": [
    {
      "name": "__construct",
      "description": "Menginisialisasi `StateRouter` internal.",
      "parameters": []
    },
    {
      "name": "handle",
      "description": "Menangani `/cancel` atau meneruskan pesan ke `StateRouter`.",
      "parameters": [
        {
          "name": "app",
          "type": "App"
        },
        {
          "name": "message",
          "type": "array",
          "description": "Data pesan dari Telegram."
        }
      ],
      "logic_flow": [
        "1. Jika teks pesan adalah `/cancel`, panggil `UserRepository::setUserState(null)` untuk membersihkan state dan kirim pesan pembatalan.",
        "2. Jika tidak, ambil nama state dari data pengguna.",
        "3. Panggil `StateRouter->getState()` untuk mendapatkan handler yang sesuai.",
        "4. Jika handler ditemukan, panggil metode `handle()`-nya dengan konteks state yang relevan."
      ]
    }
  ]
}
