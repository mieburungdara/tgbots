{
  "class_name": "BuyCallback",
  "implements": "CallbackCommandInterface",
  "summary": "Memproses transaksi pembelian sebuah paket konten.",
  "description": "Callback ini dipicu saat pengguna menekan tombol \"Beli\". Ia akan memvalidasi saldo, memproses transaksi (mengubah saldo dan mencatat penjualan), mengubah status paket, dan kemudian mendelegasikan ke `ViewPageCallback` untuk menampilkan konten.",
  "dependencies": [
    "MediaPackageRepository",
    "SaleRepository"
  ],
  "methods": [
    {
      "name": "execute",
      "description": "Menjalankan logika pembelian. Melempar Exception jika gagal, yang akan ditangkap oleh `UpdateDispatcher` untuk me-rollback transaksi.",
      "parameters": [
        {
          "name": "app",
          "type": "App"
        },
        {
          "name": "callback_query",
          "type": "array"
        },
        {
          "name": "public_id",
          "type": "string"
        }
      ],
      "logic_flow": [
        "1. Validasi bahwa paket tersedia dan saldo pengguna mencukupi.",
        "2. Panggil `SaleRepository::createSale()` untuk memperbarui saldo dan membuat catatan penjualan.",
        "3. Panggil `MediaPackageRepository::markAsSold()` untuk mengubah status paket.",
        "4. Kirim pesan konfirmasi pembelian.",
        "5. Panggil `ViewPageCallback->execute()` untuk langsung menampilkan konten yang baru dibeli.",
        "6. Menampilkan tombol `Beri Ulasan Penjual` setelah pembelian berhasil."
      ]
    }
  ]
}