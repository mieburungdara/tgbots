{
  "class_name": "AwaitingPriceState",
  "implements": "StateInterface",
  "summary": "Menangani input harga dari pengguna setelah perintah `/sell`.",
  "description": "Kelas ini dieksekusi oleh `StateRouter` ketika pengguna mengirim pesan saat statusnya adalah `awaiting_price`. Ia memvalidasi harga, membuat paket media, mengasosiasikan media, menyalinnya ke penyimpanan, dan menyelesaikan alur penjualan.",
  "dependencies": [
    "UserRepository",
    "MediaPackageRepository",
    "BotChannelUsageRepository",
    "MediaFileRepository"
  ],
  "methods": [
    {
      "name": "handle",
      "description": "Memproses input harga dari pengguna.",
      "parameters": [
        {
          "name": "message",
          "type": "array",
          "description": "Data pesan yang berisi harga."
        },
        {
          "name": "state_context",
          "type": "array",
          "description": "Konteks dari alur `/sell`, berisi detail media yang akan dijual."
        }
      ],
      "logic_flow": [
        "1. Validasi bahwa input adalah angka integer positif.",
        "2. Panggil metode privat `createMediaPackage` untuk membuat entri di `media_packages` dan menautkan `media_files`.",
        "3. Reset state pengguna menjadi `null`.",
        "4. Panggil `BotChannelUsageRepository::getNextChannelForBot()` untuk mendapatkan channel backup.",
        "5. Jika channel backup ada, panggil metode privat `backupMedia`.",
        "6. Kirim pesan konfirmasi ke pengguna dengan ID paket yang baru."
      ]
    },
    {
      "name": "backupMedia",
      "description": "Menyalin semua file media dari paket ke channel penyimpanan yang ditentukan.",
      "logic_flow": [
        "1. Ambil semua file media untuk paket tersebut.",
        "2. Kelompokkan file berdasarkan `chat_id` aslinya.",
        "3. Untuk setiap kelompok, salin pesannya ke channel backup menggunakan `copyMessage` atau `copyMessages`.",
        "4. Setelah setiap penyalinan berhasil, panggil `MediaFileRepository::updateStorageInfo()` untuk mencatat lokasi penyimpanan yang baru."
      ]
    }
  ]
}
