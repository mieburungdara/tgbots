{
  "class_name": "MediaHandler",
  "implements": "HandlerInterface",
  "summary": "Menyimpan metadata media dan menyalinnya ke channel penyimpanan.",
  "description": "Handler ini dipanggil untuk setiap pesan media. Tugasnya adalah menyimpan semua metadata media ke tabel `media_files`, kemudian mencoba menyalin media tersebut ke channel penyimpanan (backup) yang ditentukan, dan terakhir memperbarui record di `media_files` dengan lokasi penyimpanan yang baru.",
  "dependencies": [
    "MediaFileRepository",
    "BotChannelUsageRepository"
  ],
  "methods": [
    {
      "name": "handle",
      "description": "Mengekstrak metadata, menyimpan, menyalin ke penyimpanan, dan memperbarui lokasi.",
      "parameters": [
        {
          "name": "app",
          "type": "App"
        },
        {
          "name": "message",
          "type": "array",
          "description": "Data pesan dari Telegram yang berisi media."
        }
      ],
      "logic_flow": [
        "1. Mengidentifikasi tipe media (foto, video, dll.) dari pesan.",
        "2. Mengumpulkan semua parameter metadata yang relevan.",
        "3. Memanggil `MediaFileRepository::saveMediaFile()` untuk membuat catatan awal di database.",
        "4. Memanggil `BotChannelUsageRepository::getNextChannelForBot()` untuk mendapatkan channel penyimpanan berikutnya (round-robin).",
        "5. Jika channel penyimpanan ditemukan, panggil `TelegramAPI::copyMessage()` untuk menyalin media ke sana.",
        "6. Jika penyalinan berhasil, panggil `MediaFileRepository::updateStorageInfo()` untuk memperbarui record media dengan `storage_channel_id` dan `storage_message_id` yang baru.",
        "7. Mencatat semua langkah dan potensi kegagalan ke log."
      ]
    }
  ]
}
