{
  "class_name": "MessageHandler",
  "implements": "HandlerInterface",
  "summary": "Router utama untuk semua pesan masuk.",
  "description": "Ini adalah handler utama untuk pesan teks dan media. Ia mendelegasikan tugas ke handler atau router yang lebih spesifik berdasarkan urutan prioritas.",
  "dependencies": [
    "CommandRouter",
    "StateHandler",
    "AutomaticForwardHandler"
  ],
  "methods": [
    {
      "name": "__construct",
      "description": "Menginisialisasi semua router dan handler bawahan.",
      "parameters": []
    },
    {
      "name": "handle",
      "description": "Menganalisis pesan dan mendelegasikannya berdasarkan prioritas.",
      "parameters": [
        {
          "name": "app",
          "type": "App"
        },
        {
          "name": "message",
          "type": "array",
          "description": "Data pesan dari Telegram."
        }
      ],
      "logic_flow": [
        "1. **Prioritas 1: Forward Otomatis**: Jika pesan adalah `is_automatic_forward`, panggil `AutomaticForwardHandler` dan berhenti.",
        "2. **Prioritas 2: Perintah**: Jika teks pesan dimulai dengan `/`, panggil `CommandRouter` untuk menemukan dan mengeksekusi perintah yang sesuai, lalu berhenti.",
        "3. **Prioritas 3: Pesan Stateful**: Jika pengguna memiliki state aktif (misalnya, `awaiting_price`) dan pesan adalah teks, panggil `StateHandler` dan berhenti.",
        "4. Jika tidak ada kondisi di atas yang terpenuhi, pesan akan diabaikan."
      ]
    }
  ]
}
