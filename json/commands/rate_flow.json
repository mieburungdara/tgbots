{
  "flow_name": "/rate",
  "summary": "Memulai alur pemberian rating untuk sebuah media.",
  "description": "Dipicu dengan me-reply sebuah media dengan perintah \/rate. Perintah ini melakukan serangkaian validasi sebelum mengubah state pengguna untuk menunggu pemilihan kategori.",
  "handler": "`RateCommand.php`",
  "initial_checks": [
    {
      "check": 1,
      "name": "Pengecekan Fitur Bot",
      "action": "Memastikan `assigned_feature` untuk bot adalah 'rate'. Jika tidak, panggil `BotRepository::findAllBotsByFeature()` untuk menyarankan bot yang benar dan berhenti."
    },
    {
      "check": 2,
      "name": "Pengecekan Kiriman Tertunda",
      "action": "Memanggil `MediaPackageRepository::hasPendingPost()` untuk memeriksa apakah pengguna sudah memiliki kiriman yang menunggu moderasi. Jika ya, kirim pesan dan berhenti."
    },
    {
      "check": 3,
      "name": "Validasi Pesan Balasan (Reply)",
      "action": "Memastikan perintah ini adalah balasan untuk pesan lain, dan pesan tersebut berisi foto atau video. Jika tidak, kirim error dan berhenti."
    },
    {
      "check": 4,
      "name": "Validasi Kepemilikan Media",
      "action": "Memastikan `from_id` dari pesan yang dibalas sama dengan ID pengguna saat ini. Jika tidak, kirim error dan berhenti."
    }
  ],
  "main_flow": [
    {
      "step": 1,
      "name": "Pengaturan State Pengguna",
      "description": "Setelah semua validasi berhasil, panggil `UserRepository::setUserState()` untuk mengubah state pengguna menjadi `awaiting_rate_category` dan menyimpan konteks pesan yang dibalas (`message_id`, `chat_id`, `from_id`)."
    },
    {
      "step": 2,
      "name": "Permintaan Pemilihan Kategori",
      "description": "Mengirim pesan kepada pengguna dengan teks \"Silakan pilih kategori:\" dan menyertakan keyboard inline dengan pilihan kategori. Pesan ini dikirim sebagai balasan ke media yang akan di-rate."
    }
  ],
  "next_flow": "Alur selanjutnya ditangani oleh `CallbackQueryHandler` ketika pengguna menekan salah satu tombol kategori, yang akan memicu `RateCallback`."
}