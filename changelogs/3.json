{
    "changelog": [
        {
            "version": "3.12.4",
            "date": "2025-08-14",
            "changes": {
                "Diperbaiki": [
                    "**Fatal Error di MessageHandler**: Memperbaiki error fatal `Call to a member function hasUserPurchased() on null` yang terjadi saat memproses pesan biasa.\n  - **Penyebab**: `MessageHandler` tidak menginisialisasi `SaleRepository` di dalam constructor-nya, sehingga properti `$this->sale_repo` bernilai `null` saat coba diakses.\n  - **Solusi**: Menambahkan inisialisasi `SaleRepository` di dalam constructor `MessageHandler.php` untuk memastikan semua dependensi tersedia."
                ]
            }
        },
        {
            "version": "3.12.3",
            "date": "2025-08-14",
            "changes": {
                "Diperbaiki": [
                    "**Fatal Error di Perintah /konten**: Memperbaiki error fatal `Column not found: 1054 Unknown column 'file_id'` yang terjadi saat menggunakan perintah `/konten`.\n  - **Penyebab**: Serupa dengan error sebelumnya, query untuk mengambil data thumbnail di dalam `handleKontenCommand` masih mencoba memilih kolom `file_id` yang sudah dihapus.\n  - **Solusi**: Menghapus referensi ke `file_id` dari query SQL di `MessageHandler.php`."
                ]
            }
        },
        {
            "version": "312.2",
            "date": "2025-08-14",
            "changes": {
                "Diperbaiki": [
                    "**Fatal Error di Halaman Log Media**: Memperbaiki error fatal `Column not found: 1054 Unknown column 'mf.file_id'` pada halaman `admin/media_logs.php`.\n  - **Penyebab**: Halaman log media masih mencoba memilih kolom `file_id` dari database, padahal kolom tersebut sudah dihapus pada optimisasi skema sebelumnya (v3.10.0).\n  - **Solusi**: Menghapus referensi ke `mf.file_id` dari query SQL di halaman log media."
                ]
            }
        },
        {
            "version": "3.12.1",
            "date": "2025-08-14",
            "changes": {
                "Diperbaiki": [
                    "**Error di Panel Admin**: Memperbaiki `Warning: Undefined array key \"first_name\"` dan error `htmlspecialchars()` terkait yang muncul di dropdown pemilihan bot pada halaman utama panel admin.\n  - **Penyebab**: Query database di `admin/index.php` masih memilih kolom `name` yang lama, padahal seharusnya `first_name` sesuai dengan skema database terbaru.\n  - **Solusi**: Mengubah query SQL untuk memilih `first_name` dan menambahkan null coalescing operator (`??`) pada `htmlspecialchars()` untuk mencegah error jika nama bot kosong."
                ]
            }
        },
        {
            "version": "3.12.0",
            "date": "2025-08-13",
            "changes": {
                "Ditambahkan": [
                    "**Mode Edit Paket dengan /addmedia <ID>**: Perintah `/addmedia` sekarang memiliki fungsionalitas ganda untuk mengedit paket yang sudah ada.\n  - **Alur Kerja Baru**: Penjual dapat menggunakan `/addmedia <ID_PAKET>` sambil me-reply media baru untuk menambahkannya ke paket yang sudah ada dan tersedia.\n  - **Otorisasi**: Sistem akan memverifikasi bahwa pengguna yang menjalankan perintah adalah pemilik sah dari paket tersebut.\n  - **Penambahan Konten**: Media baru (termasuk seluruh item dari media group) akan disalin ke channel penyimpanan yang sama dengan konten lama dan ditautkan ke paket yang ada di database.\n  - **Tujuan**: Memberikan fleksibilitas kepada penjual untuk memperbarui dan memperluas konten paket mereka bahkan setelah paket tersebut dirilis."
                ]
            }
        },
        {
            "version": "3.11.0",
            "date": "2025-08-13",
            "changes": {
                "Ditambahkan": [
                    "**Perintah /addmedia untuk Paket Multi-bagian**: Penjual sekarang dapat membuat paket konten yang besar dengan menambahkan media secara bertahap.\n  - **Alur Kerja Baru**: Setelah memulai dengan `/sell`, penjual dapat menggunakan perintah `/addmedia` baru sambil me-reply media atau album tambahan. Proses ini dapat diulang beberapa kali.\n  - **State Management**: Logika state pengguna (`awaiting_price`) telah direfaktor untuk dapat menampung beberapa media atau media group dalam satu sesi pembuatan paket.\n  - **Finalisasi**: Saat penjual akhirnya memasukkan harga, bot akan memproses semua media yang telah ditambahkan, menyalin semuanya ke channel penyimpanan, dan menggabungkannya ke dalam satu paket tunggal.\n  - **Tujuan**: Memungkinkan penjual untuk melampaui batas 10 item per media group di Telegram, sehingga dapat menjual paket konten yang jauh lebih besar (hingga 100 item atau lebih)."
                ]
            }
        },
        {
            "version": "3.10.0",
            "date": "2025-08-13",
            "changes": {
                "Peningkatan": [
                    "**Optimisasi Skema Database**: Menghapus kolom `file_id` yang tidak lagi diperlukan dari tabel `media_files`.\n  - **Alasan**: Sejak implementasi `copyMessage` dan `copyMessages` sebagai metode utama untuk mengirim media, `file_id` menjadi berlebihan. Referensi ke media sekarang secara konsisten ditangani menggunakan `chat_id` dan `message_id`.\n  - **Keuntungan**: Mengurangi ukuran database dan menyederhanakan logika `MediaHandler` dan `MediaFileRepository` dengan menghapus penyimpanan dan penanganan data yang tidak terpakai."
                ]
            }
        },
        {
            "version": "3.9.0",
            "date": "2025-08-13",
            "changes": {
                "Diubah": [
                    "**Penanganan Penjualan Album/Media Group**: Mengubah logika inti dari proses penjualan untuk mendukung album (media group) secara penuh.\n  - **Sebelumnya**: Saat menjual sebuah album, bot akan hanya menyalin satu media (yang di-reply oleh pengguna) ke channel penyimpanan.\n  - **Sekarang**: Jika bot mendeteksi penjualan sebuah media group, bot akan menyalin *setiap* media dari grup tersebut ke channel penyimpanan, memastikan pembeli menerima semua konten."
                ],
                "Peningkatan": [
                    "**Optimisasi Penyalinan Album**: Proses penyalinan media group sekarang menggunakan metode `copyMessages` dari API Telegram, yang menyalin semua media dalam satu panggilan API tunggal, bukan satu per satu. Ini secara signifikan mengurangi jumlah panggilan API, membuat proses penjualan album lebih cepat dan efisien."
                ]
            }
        },
        {
            "version": "3.8.1",
            "date": "2025-08-13",
            "changes": {
                "Peningkatan": [
                    "**Pesan Konfirmasi /sell yang Lebih Informatif**: Saat pengguna memulai perintah `/sell`, pesan yang meminta harga sekarang juga menampilkan rincian konten yang akan dijual.\n  - **Rincian Konten**: Pesan sekarang menyertakan pratinjau deskripsi (caption) dan rincian jumlah media berdasarkan jenisnya (misal: `1 ğŸ“¹, 3 ğŸ–¼ï¸`).\n  - **Instruksi Pembatalan**: Pesan juga secara eksplisit memberitahu pengguna bahwa mereka dapat mengetik `/cancel` untuk membatalkan proses penjualan.\n  - **Tujuan**: Memberikan konfirmasi yang jelas kepada penjual tentang item apa yang sedang mereka proses, meningkatkan kejelasan alur kerja, dan mengurangi kesalahan."
                ]
            }
        },
        {
            "version": "3.8.0",
            "date": "2025-08-13",
            "changes": {
                "Diubah": [
                    "**Refactoring Alur Perintah /sell**: Merombak total alur kerja perintah `/sell` untuk meningkatkan efisiensi dan keandalan, terutama dalam menangani pembatalan.\n  - **Sebelumnya**: Saat `/sell` digunakan, bot akan langsung menyalin media ke channel penyimpanan dan membuat entri paket `pending` di database (menaikkan nomor urut ID konten) *sebelum* meminta harga. Jika pengguna membatalkan, media sampah dan ID yang terlewat akan tertinggal.\n  - **Sekarang**: Proses dibalik. Perintah `/sell` sekarang hanya akan menangkap konteks media dan meminta harga. Semua aksi beratâ€”menyalin media, membuat paket, dan menaikkan nomor urut IDâ€”ditunda dan hanya akan dijalankan *setelah* penjual memberikan harga yang valid.\n  - **Keuntungan**: Pembatalan (`/cancel`) sekarang bersih dan tidak meninggalkan data sisa. ID konten hanya akan digunakan dan di-increment saat transaksi benar-benar dikonfirmasi dengan harga, mencegah adanya celah dalam urutan ID."
                ]
            }
        },
        {
            "version": "3.7.0",
            "date": "2025-08-13",
            "changes": {
                "Ditambahkan": [
                    "**Sinkronisasi Caption yang Diedit**: Bot sekarang dapat mendeteksi saat pengguna mengedit caption sebuah media.\n  - **Logika Baru**: Menambahkan handler baru (`EditedMessageHandler`) yang akan aktif saat menerima pembaruan `edited_message` dari Telegram.\n  - **Pembaruan Database**: Jika pesan yang diedit terhubung ke sebuah file media yang tersimpan di database, bot akan secara otomatis memperbarui kolom `caption` di tabel `media_files` dengan teks yang baru. Ini memastikan bahwa deskripsi produk selalu sinkron, bahkan jika penjual mengubahnya setelah pengiriman awal."
                ]
            }
        },
        {
            "version": "3.6.2",
            "date": "2025-08-13",
            "changes": {
                "Peningkatan": [
                    "**Deteksi Caption pada Media Group**: Meningkatkan logika perintah `/sell` secara signifikan.\n  - **Sebelumnya**: Bot hanya mengambil caption dari satu media spesifik yang di-reply oleh pengguna. Jika pengguna me-reply pada gambar atau video dalam sebuah album yang tidak memiliki caption, maka deskripsi produk akan menjadi kosong.\n  - **Sekarang**: Jika bot mendeteksi media yang di-reply adalah bagian dari `media_group_id`, bot akan secara otomatis memindai semua item dalam grup tersebut di database untuk menemukan caption yang ada. Ini memastikan deskripsi produk terisi dengan benar, tidak peduli item mana dalam album yang di-reply oleh pengguna."
                ]
            }
        },
        {
            "version": "3.6.1",
            "date": "2025-08-13",
            "changes": {
                "Diperbaiki": [
                    "**Masalah Transaksi Bersarang**: Memperbaiki bug kritis di mana perintah `/sell` akan gagal dengan error `There is already an active transaction`.\n  - **Penyebab**: Logika webhook utama sudah memulai sebuah transaksi database untuk setiap permintaan. Namun, `PackageRepository` mencoba memulai transaksi kedua secara internal, yang menyebabkan konflik.\n  - **Solusi**: Menghapus logika transaksi (panggilan `beginTransaction`, `commit`, `rollBack`) yang berlebihan dari dalam metode `createPackageWithPublicId` dan `hardDeletePackage` di `PackageRepository`. Transaksi tunggal yang dikelola oleh `webhook.php` sekarang mencakup seluruh operasi, memastikan integritas data tanpa menyebabkan error."
                ]
            }
        },
        {
            "version": "3.6.0",
            "date": "2025-08-13",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Bersihkan Database (Admin)**: Menambahkan fitur berisiko tinggi di halaman `admin/database.php` untuk membersihkan semua data transaksional.\n  - **Aksi**: Menghapus semua data dari tabel `users`, `sales`, `media_packages`, `media_files`, dan tabel terkait lainnya.\n  - **Tujuan**: Memungkinkan admin untuk memulai ulang (reset) data aplikasi tanpa menghapus konfigurasi penting seperti `bots` dan `private_channels`.\n  - **Keamanan**: Fitur ini ditempatkan di \"Zona Berbahaya\" dengan teks peringatan yang jelas dan dialog konfirmasi ganda untuk mencegah penggunaan yang tidak disengaja."
                ]
            }
        },
        {
            "version": "3.5.0",
            "date": "2025-08-13",
            "changes": {
                "Diubah": [
                    "**Format ID Konten**: Mengubah format ID konten yang dilihat pengguna menjadi `XXXX_YYYY` (4 huruf acak unik per penjual, diikuti 4 angka berurutan per penjual).\n  - **Alur Registrasi Penjual**: Saat pengguna pertama kali menggunakan `/sell`, bot akan memandu mereka melalui proses pendaftaran singkat untuk mendapatkan ID Penjual publik yang unik (misal: `ASDF`).\n  - **ID Konten Berurutan per Penjual**: Setiap konten yang dibuat oleh penjual akan mendapatkan nomor urut, menghasilkan ID seperti `ASDF_0001`, `ASDF_0002`, dst.\n  - **Pembaruan Database & Kode**: Menambahkan kolom `public_seller_id` dan `seller_package_sequence` ke tabel `users`, serta `public_id` ke `media_packages`. Semua antarmuka pengguna diperbarui untuk menggunakan format ID baru ini.\n  - **Skrip Back-fill**: Menyertakan skrip `migrations/populate_public_ids.php` untuk menghasilkan ID baru ini bagi semua data penjual dan konten yang sudah ada."
                ]
            }
        },
        {
            "version": "3.4.0",
            "date": "2025-08-13",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Analitik Penjualan**: Menambahkan dasbor analitik baru untuk admin dan penjual.\n  - **Halaman Analitik Admin (`admin/analytics.php`)**: Halaman baru yang menampilkan ringkasan penjualan global, termasuk total pendapatan, jumlah penjualan, grafik pendapatan harian, dan daftar konten terlaris.\n  - **Analitik di Dasbor Member**: Penjual sekarang dapat melihat ringkasan pendapatan dan jumlah penjualan pribadi mereka langsung di halaman dasbor member.\n  - **`AnalyticsRepository`**: Membuat repository baru yang didedikasikan untuk menangani query analitik yang kompleks."
                ]
            }
        },
        {
            "version": "3.3.0",
            "date": "2025-08-12",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Proteksi Konten**: Penjual sekarang dapat melindungi konten mereka agar tidak dapat disimpan atau diteruskan oleh pembeli.\n  - **Tombol Toggle di Panel Member**: Di halaman \"Konten Dijual\", setiap paket memiliki tombol *toggle* untuk mengaktifkan/menonaktifkan proteksi.\n  - **Penerapan via `protect_content`**: Saat pembeli mengakses konten yang diproteksi, sistem akan menggunakan parameter `protect_content=true` dari API Telegram, yang mencegah penyimpanan, penerusan, dan *screenshot* pada sebagian besar perangkat.\n  - **Perubahan Database**: Menambahkan kolom `protect_content` ke tabel `media_packages`."
                ]
            }
        },
        {
            "version": "3.2.0",
            "date": "2025-08-12",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Hard-Delete Konten (Admin)**: Memberikan admin kemampuan untuk menghapus konten secara permanen.\n  - **Halaman Manajemen Konten**: Membuat halaman baru `admin/packages.php` yang menampilkan semua paket konten dalam sistem.\n  - **Tombol Hapus Permanen**: Setiap konten di halaman baru ini memiliki tombol \"Hard Delete\". Tombol ini dinonaktifkan untuk konten yang sudah terjual untuk melindungi riwayat transaksi.\n  - **Logika Penghapusan Penuh**: Aksi ini akan menghapus paket dari database, menghapus semua file media terkait dari database, dan juga menghapus pesan media dari channel penyimpanan pribadi di Telegram."
                ]
            }
        },
        {
            "version": "3.1.0",
            "date": "2025-08-12",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Soft-Delete Konten**: Member sekarang dapat menghapus konten yang mereka jual dari halaman \"Konten Dijual\".\n  - Ini adalah *soft delete*: status paket diubah menjadi `deleted` dan tidak lagi ditampilkan, tetapi data tetap ada di database untuk integritas arsip.\n  - Konten yang sudah terjual (`sold`) tidak dapat dihapus.\n  - Menambahkan status `deleted` baru ke kolom `status` pada tabel `media_packages`."
                ]
            }
        },
        {
            "version": "3.0.0",
            "date": "2025-08-12",
            "changes": {
                "Ditambahkan": [
                    "**Fitur Panel Member**: Memperluas fungsionalitas panel member secara signifikan dengan menambahkan dua halaman baru.\n  - **Halaman Konten Dijual (`member/sold.php`)**: Member sekarang dapat melihat riwayat semua konten yang telah mereka jual, lengkap dengan status (pending, available, sold).\n  - **Halaman Konten Dibeli (`member/purchased.php`)**: Member dapat melihat riwayat semua konten yang telah mereka beli, beserta harga dan tanggal pembelian.",
                    "**Peningkatan Navigasi Member**: Mendesain ulang header di seluruh panel member untuk menyertakan navigasi yang jelas antara halaman Dashboard, Dijual, dan Dibeli.",
                    "**Metode Repository Baru**: Menambahkan `findAllBySellerId` ke `PackageRepository` dan `findPackagesByBuyerId` ke `SaleRepository` untuk mendukung halaman-halaman baru."
                ]
            }
        }
    ]
}